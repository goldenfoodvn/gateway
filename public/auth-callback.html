<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Äang Ä‘Äƒng nháº­p...</title>
  <link rel="stylesheet" href="/app.css">
</head>
<body>
  <main style="text-align: center; padding: 40px;">
    <div style="display: inline-block; width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;"></div>
    <h2>ğŸ” Äang xá»­ lÃ½ Ä‘Äƒng nháº­p...</h2>
    <p id="status">Vui lÃ²ng Ä‘á»£i...</p>
  </main>
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <script>
    // Parse tokens from URL hash
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    
    const accessToken = params.get('access_token');
    const refreshToken = params.get('refresh_token');
    const error = params.get('error');
    
    if (error) {
      document.getElementById('status').textContent = 'ÄÄƒng nháº­p tháº¥t báº¡i: ' + error;
      setTimeout(() => window.location.href = '/oauth-test.html', 3000);
    } else if (accessToken && refreshToken) {
      // Store tokens with validation
      const expiresIn = params.get('expires_in');
      const expiryTime = expiresIn && !isNaN(parseInt(expiresIn)) 
        ? Date.now() + parseInt(expiresIn) * 1000 
        : Date.now() + 3600 * 1000; // Default 1 hour
      
      localStorage.setItem('accessToken', accessToken);
      localStorage.setItem('refreshToken', refreshToken);
      localStorage.setItem('tokenExpiry', expiryTime.toString());
      localStorage.setItem('userEmail', params.get('email') || '');
      localStorage.setItem('userName', params.get('name') || '');
      localStorage.setItem('authProvider', params.get('provider') || '');
      
      document.getElementById('status').textContent = 'âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!';
      setTimeout(() => window.location.href = '/oauth-test.html', 2000);
    } else {
      document.getElementById('status').textContent = 'Lá»—i: KhÃ´ng nháº­n Ä‘Æ°á»£c token';
      setTimeout(() => window.location.href = '/oauth-test.html', 3000);
    }
  </script>
</body>
</html>
